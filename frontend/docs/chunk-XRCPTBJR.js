import{D as m,P as I,U as w,a as b,b as D,m as d,n as s,y as h}from"./chunk-JKZU3RR7.js";var k=(()=>{class g{constructor(){this.STORAGE_KEYS={SERVICOS:"barbearia_servicos",AGENDAMENTOS:"barbearia_agendamentos",FEEDBACKS:"barbearia_feedbacks",CONFIGURACOES:"barbearia_configuracoes"},this.inicializarDados()}inicializarDados(){if(!localStorage.getItem(this.STORAGE_KEYS.SERVICOS)){let a=[{id:1,nome:"Corte Masculino",descricao:"Corte de cabelo moderno com t\xE9cnicas profissionais",duracao:30,preco:35,imagemUrl:void 0,ativo:!0,ordem:1},{id:2,nome:"Barba",descricao:"Aparar e modelar barba com navalha e tesoura",duracao:20,preco:25,imagemUrl:void 0,ativo:!0,ordem:2},{id:3,nome:"Corte + Barba",descricao:"Pacote completo: corte de cabelo e barba",duracao:45,preco:50,imagemUrl:void 0,ativo:!0,ordem:3},{id:4,nome:"Sobrancelha",descricao:"Design e modelagem de sobrancelhas",duracao:15,preco:15,imagemUrl:void 0,ativo:!0,ordem:4},{id:5,nome:"Relaxamento Capilar",descricao:"Tratamento de relaxamento para cabelos crespos e ondulados",duracao:60,preco:80,imagemUrl:void 0,ativo:!0,ordem:5},{id:6,nome:"Pigmenta\xE7\xE3o de Barba",descricao:"Aplica\xE7\xE3o de pigmento para dar volume \xE0 barba",duracao:40,preco:70,imagemUrl:void 0,ativo:!0,ordem:6}];this.salvarServicos(a)}if(!localStorage.getItem(this.STORAGE_KEYS.CONFIGURACOES)){let a={horaInicio:"09:00",horaFim:"18:00",intervaloAgendamentos:15};localStorage.setItem(this.STORAGE_KEYS.CONFIGURACOES,JSON.stringify(a))}localStorage.getItem(this.STORAGE_KEYS.AGENDAMENTOS)||localStorage.setItem(this.STORAGE_KEYS.AGENDAMENTOS,JSON.stringify([]));let e=localStorage.getItem(this.STORAGE_KEYS.FEEDBACKS),t=[];try{t=e?JSON.parse(e):[]}catch{t=[]}let r=t.some(a=>a.id>=1&&a.id<=6);if(t.length===0||!r){let a=[{id:1,nome:"Carlos Silva",avaliacao:5,comentario:"Excelente atendimento! O barbeiro foi muito profissional e atencioso. O corte ficou exatamente como eu queria. Com certeza voltarei!",fotoUrl:void 0,aprovado:!0,respostaAdmin:void 0,criadoEm:new Date(Date.now()-432e6).toISOString()},{id:2,nome:"Jo\xE3o Pedro Santos",avaliacao:5,comentario:"Melhor barbearia da cidade! Ambiente limpo, profissionais qualificados e pre\xE7o justo. Recomendo para todos!",fotoUrl:void 0,aprovado:!0,respostaAdmin:void 0,criadoEm:new Date(Date.now()-2592e5).toISOString()},{id:3,nome:"Roberto Almeida",avaliacao:5,comentario:"Atendimento de primeira! Fui muito bem recebido, o servi\xE7o foi r\xE1pido e com muita qualidade. Valeu cada centavo!",fotoUrl:void 0,aprovado:!0,respostaAdmin:void 0,criadoEm:new Date(Date.now()-6048e5).toISOString()},{id:4,nome:"Lucas Ferreira",avaliacao:5,comentario:"Profissionais muito competentes e ambiente agrad\xE1vel. O corte ficou perfeito, exatamente o que eu precisava. Super recomendo!",fotoUrl:void 0,aprovado:!0,respostaAdmin:void 0,criadoEm:new Date(Date.now()-1728e5).toISOString()},{id:5,nome:"Marcos Oliveira",avaliacao:5,comentario:"Atendimento impec\xE1vel! O barbeiro entendeu perfeitamente o que eu queria e o resultado superou minhas expectativas. Excelente trabalho!",fotoUrl:void 0,aprovado:!0,respostaAdmin:void 0,criadoEm:new Date(Date.now()-864e6).toISOString()},{id:6,nome:"Felipe Costa",avaliacao:5,comentario:"Barbearia de qualidade! Ambiente moderno, profissionais experientes e atendimento personalizado. Ficou excelente!",fotoUrl:void 0,aprovado:!0,respostaAdmin:void 0,criadoEm:new Date(Date.now()-864e5).toISOString()}];localStorage.setItem(this.STORAGE_KEYS.FEEDBACKS,JSON.stringify(a))}}getServicos(e=!1){let t=this.carregarServicos(),r=e?t.filter(a=>a.ativo):t;return r=r.sort((a,o)=>(a.ordem||0)-(o.ordem||0)),d(r).pipe(m(300))}getServicoById(e){let r=this.carregarServicos().find(a=>a.id===e)||null;return d(r).pipe(m(200))}criarServico(e){let t=this.carregarServicos(),a={id:t.length>0?Math.max(...t.map(o=>o.id))+1:1,nome:e.nome,descricao:e.descricao||"",duracao:e.duracao||30,preco:e.preco||0,imagemUrl:e.imagemUrl||void 0,ativo:e.ativo!==void 0?e.ativo:!0,ordem:e.ordem||0};return t.push(a),this.salvarServicos(t),d(a).pipe(m(400))}atualizarServico(e,t){let r=this.carregarServicos(),a=r.findIndex(o=>o.id===e);return a===-1?s(()=>new Error("Servi\xE7o n\xE3o encontrado")):(r[a]=b(b({},r[a]),t),this.salvarServicos(r),d(r[a]).pipe(m(400)))}excluirServico(e){let t=this.carregarAgendamentos(),r=new Date;if(r.setHours(0,0,0,0),t.some(i=>{let v=new Date(i.dataHora);return i.servicoId===e&&v>=r&&i.status!=="Cancelado"}))return s(()=>new Error("N\xE3o \xE9 poss\xEDvel excluir servi\xE7o com agendamentos futuros"));let o=this.carregarServicos(),c=o.findIndex(i=>i.id===e);return c===-1?s(()=>new Error("Servi\xE7o n\xE3o encontrado")):(o.splice(c,1),this.salvarServicos(o),d(void 0).pipe(m(300)))}getAgendamentos(e){let t=this.carregarAgendamentos();if(e?.dataInicio){let r=new Date(e.dataInicio);t=t.filter(a=>new Date(a.dataHora)>=r)}if(e?.dataFim){let r=new Date(e.dataFim);t=t.filter(a=>new Date(a.dataHora)<=r)}if(e?.status!==void 0&&e?.status!==null&&e?.status!==""){let a={1:"Pendente",2:"Confirmado",3:"Concluido",4:"Cancelado"}[e.status]||e.status;t=t.filter(o=>o.status===a)}return t.sort((r,a)=>new Date(r.dataHora).getTime()-new Date(a.dataHora).getTime()),d(t).pipe(m(300))}getAgendamentoById(e){let r=this.carregarAgendamentos().find(a=>a.id===e)||null;return d(r).pipe(m(200))}criarAgendamento(e){let r=this.carregarServicos().find(i=>i.id===e.servicoId);if(!r||!r.ativo)return s(()=>new Error("Servi\xE7o n\xE3o encontrado ou inativo"));if(!this.isHorarioDisponivel(e.servicoId,e.dataHora))return s(()=>new Error("Hor\xE1rio n\xE3o dispon\xEDvel"));let a=this.carregarAgendamentos(),c={id:a.length>0?Math.max(...a.map(i=>i.id))+1:1,clienteNome:e.clienteNome,clienteTelefone:e.clienteTelefone,clienteEmail:e.clienteEmail||void 0,servicoId:e.servicoId,servicoNome:r.nome,dataHora:e.dataHora,status:"Pendente",observacoes:e.observacoes||void 0,criadoEm:new Date().toISOString()};return a.push(c),this.salvarAgendamentos(a),d(c).pipe(m(400))}atualizarAgendamento(e,t){let r=this.carregarAgendamentos(),a=r.findIndex(E=>E.id===e);if(a===-1)return s(()=>new Error("Agendamento n\xE3o encontrado"));let c=this.carregarServicos().find(E=>E.id===t.servicoId);if(!c||!c.ativo)return s(()=>new Error("Servi\xE7o n\xE3o encontrado ou inativo"));let i=r[a];if((i.dataHora!==t.dataHora||i.servicoId!==t.servicoId)&&!this.isHorarioDisponivel(t.servicoId,t.dataHora,e))return s(()=>new Error("Hor\xE1rio n\xE3o dispon\xEDvel"));let v={1:"Pendente",2:"Confirmado",3:"Concluido",4:"Cancelado"};return r[a]=D(b({},r[a]),{clienteNome:t.clienteNome,clienteTelefone:t.clienteTelefone,clienteEmail:t.clienteEmail||void 0,servicoId:t.servicoId,servicoNome:c.nome,dataHora:t.dataHora,status:typeof t.status=="number"?v[t.status]||"Pendente":t.status,observacoes:t.observacoes||null}),this.salvarAgendamentos(r),d(r[a]).pipe(m(400))}excluirAgendamento(e){let t=this.carregarAgendamentos(),r=t.findIndex(a=>a.id===e);return r===-1?s(()=>new Error("Agendamento n\xE3o encontrado")):(t.splice(r,1),this.salvarAgendamentos(t),d(void 0).pipe(m(300)))}getHorariosDisponiveis(e,t){let a=this.carregarServicos().find(p=>p.id===e);if(!a)return d([]).pipe(m(200));let o=this.carregarConfiguracoes(),c=this.parseTime(o.horaInicio),i=this.parseTime(o.horaFim),v=o.intervaloAgendamentos||15,E=[],f=new Date(t);f.setHours(0,0,0,0);let u=new Date(f);u.setHours(c.hours,c.minutes,0,0);let S=new Date(f);for(S.setHours(i.hours,i.minutes,0,0);u<S;){let p=new Date(u);if(p.setMinutes(p.getMinutes()+a.duracao),p<=S){let A=this.isHorarioDisponivel(e,u.toISOString());E.push({dataHora:u.toISOString(),disponivel:A})}u.setMinutes(u.getMinutes()+v)}return d(E).pipe(m(300))}isHorarioDisponivel(e,t,r){let a=this.carregarAgendamentos(),o=this.carregarServicos(),c=o.find(f=>f.id===e);if(!c)return!1;let i=new Date(t),v=new Date(i);return v.setMinutes(v.getMinutes()+c.duracao),a.filter(f=>{if(f.servicoId!==e||f.status==="Cancelado"||r&&f.id===r)return!1;let u=new Date(f.dataHora),S=o.find(A=>A.id===f.servicoId);if(!S)return!1;let p=new Date(u);return p.setMinutes(p.getMinutes()+S.duracao),u<=i&&p>i||u<v&&u>=i}).length===0}getFeedbacks(e=!1){let t=this.carregarFeedbacks();return e&&(t=t.filter(r=>r.aprovado)),t.sort((r,a)=>new Date(a.criadoEm).getTime()-new Date(r.criadoEm).getTime()),d(t).pipe(m(300))}criarFeedback(e){let t=this.carregarFeedbacks(),a={id:t.length>0?Math.max(...t.map(o=>o.id))+1:1,nome:e.nome,avaliacao:e.avaliacao,comentario:e.comentario,fotoUrl:e.fotoUrl||void 0,aprovado:!1,respostaAdmin:void 0,criadoEm:new Date().toISOString()};return t.push(a),this.salvarFeedbacks(t),d(a).pipe(m(400))}atualizarFeedback(e,t){let r=this.carregarFeedbacks(),a=r.findIndex(o=>o.id===e);return a===-1?s(()=>new Error("Feedback n\xE3o encontrado")):(r[a]=D(b({},r[a]),{aprovado:t.aprovado!==void 0?t.aprovado:r[a].aprovado,respostaAdmin:t.respostaAdmin!==void 0?t.respostaAdmin:r[a].respostaAdmin}),this.salvarFeedbacks(r),d(r[a]).pipe(m(400)))}excluirFeedback(e){let t=this.carregarFeedbacks(),r=t.findIndex(a=>a.id===e);return r===-1?s(()=>new Error("Feedback n\xE3o encontrado")):(t.splice(r,1),this.salvarFeedbacks(t),d(void 0).pipe(m(300)))}login(e){if(e.email==="admin@barbearia.com"&&e.senha==="admin123"){let t={token:"demo-token-"+Date.now(),nome:"Administrador",email:"admin@barbearia.com"};return d(t).pipe(m(500))}return s(()=>new Error("Email ou senha inv\xE1lidos"))}getDashboard(){let e=this.carregarAgendamentos(),t=this.carregarFeedbacks(),r=new Date;r.setHours(0,0,0,0);let a=new Date(r);a.setHours(23,59,59,999);let o=new Date(r);o.setDate(r.getDate()-r.getDay());let c=new Date(o);c.setDate(o.getDate()+6),c.setHours(23,59,59,999);let i=new Date(r.getFullYear(),r.getMonth(),1),v=new Date(r.getFullYear(),r.getMonth()+1,0,23,59,59,999),E=e.filter(n=>{let l=new Date(n.dataHora);return l>=r&&l<=a&&n.status!=="Cancelado"}).length,f=e.filter(n=>{let l=new Date(n.dataHora);return l>=o&&l<=c&&n.status!=="Cancelado"}).length,u=e.filter(n=>{let l=new Date(n.dataHora);return l>=i&&l<=v&&n.status!=="Cancelado"}).length,S=t.filter(n=>n.aprovado),p=S.length>0?S.reduce((n,l)=>n+l.avaliacao,0)/S.length:0,A=e.filter(n=>new Date(n.dataHora)>=r&&n.status!=="Cancelado").sort((n,l)=>new Date(n.dataHora).getTime()-new Date(l.dataHora).getTime()).slice(0,10),O=t.filter(n=>n.aprovado).sort((n,l)=>new Date(l.criadoEm).getTime()-new Date(n.criadoEm).getTime()).slice(0,5),F={estatisticas:{agendamentosHoje:E,agendamentosSemana:f,agendamentosMes:u,mediaAvaliacao:Math.round(p*10)/10},proximosAgendamentos:A,feedbacksRecentes:O};return d(F).pipe(m(400))}carregarServicos(){try{let e=localStorage.getItem(this.STORAGE_KEYS.SERVICOS);return e?JSON.parse(e):[]}catch{return[]}}salvarServicos(e){localStorage.setItem(this.STORAGE_KEYS.SERVICOS,JSON.stringify(e))}carregarAgendamentos(){try{let e=localStorage.getItem(this.STORAGE_KEYS.AGENDAMENTOS);return e?JSON.parse(e):[]}catch{return[]}}salvarAgendamentos(e){localStorage.setItem(this.STORAGE_KEYS.AGENDAMENTOS,JSON.stringify(e))}carregarFeedbacks(){try{let e=localStorage.getItem(this.STORAGE_KEYS.FEEDBACKS);return e?JSON.parse(e):[]}catch{return[]}}salvarFeedbacks(e){localStorage.setItem(this.STORAGE_KEYS.FEEDBACKS,JSON.stringify(e))}carregarConfiguracoes(){try{let e=localStorage.getItem(this.STORAGE_KEYS.CONFIGURACOES);return e?JSON.parse(e):{horaInicio:"09:00",horaFim:"18:00",intervaloAgendamentos:15}}catch{return{horaInicio:"09:00",horaFim:"18:00",intervaloAgendamentos:15}}}parseTime(e){let t=e.split(":");return{hours:parseInt(t[0])||9,minutes:parseInt(t[1])||0}}static{this.\u0275fac=function(t){return new(t||g)}}static{this.\u0275prov=I({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})();var M=(()=>{class g{constructor(e){this.mockApi=e}get(e,t){if(e==="servicos"||e.startsWith("servicos/")){if(e==="servicos")return this.mockApi.getServicos(t?.apenasAtivos||!1);{let r=parseInt(e.split("/")[1]);return this.mockApi.getServicoById(r)}}if(e==="agendamentos"||e.startsWith("agendamentos/")){if(e==="agendamentos")return this.mockApi.getAgendamentos(t);if(e.includes("horarios-disponiveis"))return this.mockApi.getHorariosDisponiveis(t.servicoId,t.data);{let r=parseInt(e.split("/")[1]);return this.mockApi.getAgendamentoById(r)}}return e==="feedbacks"||e.startsWith("feedbacks/")?e==="feedbacks"?this.mockApi.getFeedbacks(t?.apenasAprovados||!1):s(()=>new Error("Not implemented")):e==="auth/login"?s(()=>new Error("Use POST for login")):e==="admin/dashboard"?this.mockApi.getDashboard():s(()=>new Error(`Endpoint n\xE3o encontrado: ${e}`))}post(e,t){return e==="servicos"?this.mockApi.criarServico(t).pipe(h(r=>this.formatError(r))):e==="agendamentos"?this.mockApi.criarAgendamento(t).pipe(h(r=>this.formatError(r))):e==="feedbacks"?this.mockApi.criarFeedback(t).pipe(h(r=>this.formatError(r))):e==="auth/login"?this.mockApi.login(t).pipe(h(r=>this.formatError(r))):s(()=>new Error(`Endpoint n\xE3o encontrado: ${e}`))}put(e,t){if(e.startsWith("servicos/")){let r=parseInt(e.split("/")[1]);return this.mockApi.atualizarServico(r,t).pipe(h(a=>this.formatError(a)))}if(e.startsWith("agendamentos/")){let r=parseInt(e.split("/")[1]);return this.mockApi.atualizarAgendamento(r,t).pipe(h(a=>this.formatError(a)))}if(e.startsWith("feedbacks/")){let r=parseInt(e.split("/")[1]);return this.mockApi.atualizarFeedback(r,t).pipe(h(a=>this.formatError(a)))}return s(()=>new Error(`Endpoint n\xE3o encontrado: ${e}`))}delete(e){if(e.startsWith("servicos/")){let t=parseInt(e.split("/")[1]);return this.mockApi.excluirServico(t).pipe(h(r=>this.formatError(r)))}if(e.startsWith("agendamentos/")){let t=parseInt(e.split("/")[1]);return this.mockApi.excluirAgendamento(t).pipe(h(r=>this.formatError(r)))}if(e.startsWith("feedbacks/")){let t=parseInt(e.split("/")[1]);return this.mockApi.excluirFeedback(t).pipe(h(r=>this.formatError(r)))}return s(()=>new Error(`Endpoint n\xE3o encontrado: ${e}`))}formatError(e){let t={status:400,statusText:"Bad Request",message:e?.message||"Erro desconhecido",error:e?.message||"Erro desconhecido"};return s(()=>t)}static{this.\u0275fac=function(t){return new(t||g)(w(k))}}static{this.\u0275prov=I({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})();export{M as a};
