import{a as $,b as z,c as x,d as G,e as B,h as O,i as H,j as L,k as J,q as W,s as K}from"./chunk-DAGYDP6H.js";import{a as Q}from"./chunk-WVCKXXUK.js";import{e as q}from"./chunk-UKOXNQ6D.js";import{a as R}from"./chunk-XRCPTBJR.js";import{Ba as l,Ca as f,Gb as N,Hb as A,Ib as D,Qa as w,Ra as F,Sa as v,Ua as T,Va as n,Wa as r,Xa as g,Ya as E,Za as d,_ as U,_a as m,a as _,b as C,cb as V,db as a,eb as M,fb as b,ga as s,ha as c,ia as S,ja as I,kb as P,sb as j,wa as k}from"./chunk-JKZU3RR7.js";function Y(u,y){if(u&1){let e=E();n(0,"tr",13)(1,"td",14)(2,"div",15)(3,"img",16),d("error",function(t){s(e);let o=m();return c(o.handleImageError(t))}),r()()(),n(4,"td",17),a(5),r(),n(6,"td",18),a(7),r(),n(8,"td",18),a(9),r(),n(10,"td",14)(11,"span",19),a(12),r()(),n(13,"td",14)(14,"div",20)(15,"button",21),d("click",function(){let t=s(e).$implicit,o=m();return c(o.editar(t))}),a(16,"Editar"),r(),n(17,"button",22),d("click",function(){let t=s(e).$implicit,o=m();return c(o.excluir(t.id))}),a(18,"Excluir"),r()()()()}if(u&2){let e=y.$implicit,i=m();l(3),v("src",i.getServiceImageUrl(e),k)("alt",e.nome),l(2),M(e.nome),l(2),b("",e.duracao," min"),l(2),b("R$ ",e.preco.toFixed(2),""),l(2),T("text-green-600",e.ativo)("text-red-600",!e.ativo),l(),b(" ",e.ativo?"Ativo":"Inativo"," ")}}function Z(u,y){if(u&1){let e=E();n(0,"div",58)(1,"div",59),g(2,"img",60),n(3,"div",61)(4,"button",62),d("click",function(){s(e);let t=m(2);return c(t.removerImagem())}),a(5," Remover Imagem "),r()()(),n(6,"button",63),d("click",function(){s(e);let t=m(2);return c(t.removerImagem())}),S(),n(7,"svg",64),g(8,"path",65),r(),a(9," Remover Imagem "),r()()}if(u&2){let e=m(2);l(2),v("src",e.imagemPreview,k)}}function ee(u,y){if(u&1){let e=E();n(0,"div",23)(1,"div",24)(2,"h2",25),a(3),r(),n(4,"form",26),d("ngSubmit",function(){s(e);let t=m();return c(t.salvar())}),n(5,"div")(6,"label",27),a(7,"Nome *"),r(),g(8,"input",28),r(),n(9,"div")(10,"label",27),a(11,"Descri\xE7\xE3o"),r(),g(12,"textarea",29),r(),n(13,"div",30)(14,"div")(15,"label",27),a(16,"Dura\xE7\xE3o (min) *"),r(),g(17,"input",31),r(),n(18,"div")(19,"label",27),a(20,"Pre\xE7o *"),r(),g(21,"input",32),r()(),n(22,"div")(23,"label",27),a(24,"Imagem do Servi\xE7o"),r(),w(25,Z,10,1,"div",33),n(26,"div",34)(27,"div",35)(28,"label",36)(29,"input",37,0),d("change",function(t){s(e);let o=m();return c(o.onFileSelected(t))}),r(),n(31,"div",38),d("click",function(t){return s(e),V(30).click(),c(t.preventDefault())}),S(),n(32,"svg",39),g(33,"path",40),r(),a(34," Escolher Arquivo "),r()(),I(),n(35,"label",36)(36,"input",37,1),d("change",function(t){s(e);let o=m();return c(o.onFileSelected(t))}),r(),n(38,"div",41),d("click",function(t){return s(e),V(37).click(),c(t.preventDefault())}),S(),n(39,"svg",39),g(40,"path",42)(41,"path",43),r(),a(42," Tirar Foto "),r()()(),I(),n(43,"div",44)(44,"div",45),g(45,"div",46),r(),n(46,"div",47)(47,"span",48),a(48,"ou"),r()()(),n(49,"input",49),d("input",function(){s(e);let t=m();return c(t.onUrlChange())})("focus",function(){s(e);let t=m();return c(t.imagemFile=null)}),r(),n(50,"p",50),a(51," Formatos aceitos: JPG, PNG, GIF. Tamanho m\xE1ximo: 5MB "),r()()(),n(52,"div",51)(53,"label",52),g(54,"input",53),a(55," Ativo "),r(),n(56,"div")(57,"label",27),a(58,"Ordem"),r(),g(59,"input",54),r()(),n(60,"div",55)(61,"button",56),d("click",function(){s(e);let t=m();return c(t.fecharModal())}),a(62,"Cancelar"),r(),n(63,"button",57),a(64,"Salvar"),r()()()()()}if(u&2){let e=m();l(3),b("",e.servicoEditando?"Editar":"Novo"," Servi\xE7o"),l(),v("formGroup",e.formulario),l(21),v("ngIf",e.imagemPreview),l(11),F("capture","environment"),l(27),v("disabled",e.formulario.invalid)}}var se=(()=>{class u{constructor(e,i,t,o,p){this.apiService=e,this.fb=i,this.router=t,this.authService=o,this.cdr=p,this.servicos=[],this.mostrarModal=!1,this.imagemPreview=null,this.imagemFile=null,this.formulario=this.fb.group({nome:["",x.required],descricao:[""],duracao:[30,[x.required,x.min(1)]],preco:[0,[x.required,x.min(0)]],imagemUrl:[""],ativo:[!0],ordem:[0]})}ngOnInit(){this.carregarServicos()}carregarServicos(){let e=new Date().getTime();this.apiService.get("servicos",{_t:e}).subscribe({next:i=>{if(!i||i.length===0){this.servicos=[];return}let t=this.carregarImagensStorage();this.servicos=i.map(o=>{let p=o.imagemUrl&&o.imagemUrl.trim()!==""?o.imagemUrl:void 0,h=t[o.id];return C(_({},o),{imagemUrl:p||h||void 0})}).sort((o,p)=>(o.ordem||0)-(p.ordem||0))},error:i=>{console.error("Erro ao carregar servi\xE7os:",i),alert("Erro ao carregar servi\xE7os. Tente novamente.")}})}salvarImagemStorage(e,i){try{let t=this.carregarImagensStorage();t[e]=i,localStorage.setItem("servicos_imagens",JSON.stringify(t))}catch{this.limparImagensAntigas()}}carregarImagensStorage(){try{let e=localStorage.getItem("servicos_imagens");return e?JSON.parse(e):{}}catch{return{}}}removerImagemStorage(e){try{let i=this.carregarImagensStorage();delete i[e],localStorage.setItem("servicos_imagens",JSON.stringify(i))}catch{}}limparImagensAntigas(){try{localStorage.removeItem("servicos_imagens")}catch{}}temImagem(e){return!0}getServiceImageUrl(e){if(e.imagemUrl&&e.imagemUrl.trim()!=="")return e.imagemUrl;let i=document.querySelector("base")?.getAttribute("href")||"/",t={"Corte Masculino":`${i}assets/img/corte-masculino.jpg`,Barba:`${i}assets/img/barba.png`,"Corte + Barba":`${i}assets/img/barba-corte.jpg`,Sobrancelha:`${i}assets/img/sobrancelha.jpg`,"Pigmenta\xE7\xE3o de Barba":`${i}assets/img/pigmentacao-barba.png`,"Relaxamento Capilar":"https://images.unsplash.com/photo-1605497788044-5a32c7078486?w=800&h=600&fit=crop&q=80&auto=format"};return t[e.nome]?t[e.nome]:"https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=800&h=600&fit=crop&q=80&auto=format"}handleImageError(e){e.target.style.display="none";let i=e.target.parentElement;if(i&&!i.querySelector(".error-placeholder")){let t=document.createElement("div");t.className="error-placeholder w-full h-full bg-gray-100 flex items-center justify-center text-gray-400 text-xs text-center p-1",t.textContent="Sem Imagem",i.appendChild(t)}}abrirModal(){this.servicoEditando=void 0,this.formulario.reset({ativo:!0,duracao:30,preco:0,ordem:0}),this.imagemPreview=null,this.imagemFile=null,this.mostrarModal=!0}editar(e){this.servicoEditando=e,this.formulario.patchValue({nome:e.nome,descricao:e.descricao,duracao:e.duracao,preco:e.preco,imagemUrl:e.imagemUrl||"",ativo:e.ativo,ordem:e.ordem}),e.imagemUrl&&e.imagemUrl.trim()!==""?this.imagemPreview=e.imagemUrl:this.imagemPreview=null,this.imagemFile=null,this.mostrarModal=!0}fecharModal(){this.mostrarModal=!1,this.servicoEditando=void 0,this.formulario.reset(),this.imagemPreview=null,this.imagemFile=null}onFileSelected(e){let i=e.target.files?.[0];if(!i){e.target.value="";return}if(!i.type.startsWith("image/")){alert("Por favor, selecione apenas arquivos de imagem."),e.target.value="";return}if(i.size>5*1024*1024){alert("A imagem deve ter no m\xE1ximo 5MB."),e.target.value="";return}this.imagemFile=i;let t=new FileReader;t.onload=o=>{let p=o.target.result;this.imagemPreview=p,this.formulario.patchValue({imagemUrl:p},{emitEvent:!0}),e.target.value="",this.cdr.detectChanges()},t.onerror=()=>{alert("Erro ao ler o arquivo. Tente novamente."),e.target.value="",this.imagemFile=null,this.imagemPreview=null},t.readAsDataURL(i)}onUrlChange(){let e=this.formulario.get("imagemUrl")?.value;this.imagemFile=null,e&&(e.startsWith("http")||e.startsWith("https"))?(this.imagemPreview=e,this.imagemFile=null):e||(this.imagemPreview=null)}removerImagem(){this.imagemPreview=null,this.imagemFile=null,this.formulario.patchValue({imagemUrl:""})}salvar(){if(this.formulario.invalid)return;let e=_({},this.formulario.value);this.imagemPreview&&!e.imagemUrl&&(e.imagemUrl=this.imagemPreview),this.enviarDados(e)}enviarDados(e){let i=e.imagemUrl&&e.imagemUrl.trim()!=="";if(this.servicoEditando){let t=this.servicoEditando.id;i?this.salvarImagemStorage(t,e.imagemUrl):this.removerImagemStorage(t),this.apiService.put(`servicos/${t}`,e).subscribe({next:o=>{let p=o?.imagemUrl&&o.imagemUrl.trim()!==""?o.imagemUrl:this.carregarImagensStorage()[t];if(o&&o.id){let h=this.servicos.findIndex(X=>X.id===o.id);h!==-1&&(this.servicos[h]=C(_(_({},this.servicos[h]),o),{imagemUrl:p||void 0}))}setTimeout(()=>{this.carregarServicos(),this.fecharModal()},500)},error:o=>{if(console.error("Erro ao atualizar servi\xE7o:",o),o.status===401){alert("Sua sess\xE3o expirou. Por favor, fa\xE7a login novamente."),this.authService.logout();return}alert("Erro ao salvar servi\xE7o. Tente novamente.")}})}else this.apiService.post("servicos",e).subscribe({next:t=>{console.log("\u2705 Servi\xE7o criado - Resposta do backend:",t),t&&t.id&&i&&this.salvarImagemStorage(t.id,e.imagemUrl),setTimeout(()=>{this.carregarServicos(),this.fecharModal()},500)},error:t=>{if(console.error("\u274C Erro ao criar servi\xE7o:",t),t.status===401){alert("Sua sess\xE3o expirou. Por favor, fa\xE7a login novamente."),this.authService.logout();return}alert("Erro ao criar servi\xE7o. Verifique o console para mais detalhes.")}})}excluir(e){confirm("Tem certeza que deseja excluir este servi\xE7o?")&&this.apiService.delete(`servicos/${e}`).subscribe({next:()=>{this.carregarServicos()},error:i=>{if(console.error("Erro ao excluir servi\xE7o:",i),i.status===401){alert("Sua sess\xE3o expirou. Por favor, fa\xE7a login novamente."),this.authService.logout();return}alert("Erro ao excluir servi\xE7o. Verifique se n\xE3o h\xE1 agendamentos futuros.")}})}static{this.\u0275fac=function(i){return new(i||u)(f(R),f(W),f(q),f(Q),f(j))}}static{this.\u0275cmp=U({type:u,selectors:[["app-servicos"]],standalone:!0,features:[P],decls:26,vars:2,consts:[["fileInput",""],["cameraInput",""],[1,"space-y-4","sm:space-y-6"],[1,"flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","gap-4"],[1,"text-2xl","sm:text-3xl","font-bold","text-primary","dark:text-white"],[1,"btn-primary","w-full","sm:w-auto",3,"click"],[1,"card","overflow-hidden"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]"],[1,"border-b"],[1,"text-left","p-2"],["class","border-b hover:bg-gray-50",4,"ngFor","ngForOf"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",4,"ngIf"],[1,"border-b","hover:bg-gray-50"],[1,"p-2"],[1,"w-12","h-12","sm:w-16","sm:h-16","rounded","overflow-hidden","border","border-gray-200","bg-gray-100"],["loading","lazy",1,"w-full","h-full","object-cover",3,"error","src","alt"],[1,"p-2","font-medium","text-sm","sm:text-base"],[1,"p-2","text-sm","sm:text-base"],[1,"font-medium","text-xs","sm:text-sm"],[1,"flex","flex-col","sm:flex-row","gap-1","sm:gap-2"],[1,"text-blue-600","hover:text-blue-800","font-medium","text-xs","sm:text-sm",3,"click"],[1,"text-red-600","hover:text-red-800","font-medium","text-xs","sm:text-sm",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-2","sm:p-4"],[1,"bg-gray-100","rounded-lg","p-4","sm:p-6","max-w-2xl","w-full","max-h-[95vh]","sm:max-h-[90vh]","overflow-y-auto","dark:bg-gray-900"],[1,"text-2xl","font-bold","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block","text-sm","font-medium","mb-2"],["type","text","formControlName","nome",1,"w-full","p-2","border","rounded-lg"],["formControlName","descricao","rows","3",1,"w-full","p-2","border","rounded-lg"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-4"],["type","number","formControlName","duracao",1,"w-full","p-2","border","rounded-lg"],["type","number","step","0.01","formControlName","preco",1,"w-full","p-2","border","rounded-lg"],["class","mb-4 relative",4,"ngIf"],[1,"space-y-3"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-2"],[1,"block"],["type","file","accept","image/*",1,"hidden",3,"change"],[1,"btn-secondary","cursor-pointer","inline-flex","items-center","justify-center","gap-2","w-full","text-center","py-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"],[1,"btn-outline","cursor-pointer","inline-flex","items-center","justify-center","gap-2","w-full","text-center","py-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 13a3 3 0 11-6 0 3 3 0 016 0z"],[1,"relative"],[1,"absolute","inset-0","flex","items-center"],[1,"w-full","border-t","border-gray-300"],[1,"relative","flex","justify-center","text-sm"],[1,"px-2","bg-white","text-gray-500"],["type","url","formControlName","imagemUrl","placeholder","Cole a URL da imagem (ex: https://exemplo.com/imagem.jpg)",1,"w-full","p-2","border","rounded-lg","focus:ring-2","focus:ring-secondary","focus:border-secondary",3,"input","focus"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-4"],[1,"flex","items-center"],["type","checkbox","formControlName","ativo",1,"mr-2"],["type","number","formControlName","ordem",1,"w-20","p-2","border","rounded-lg"],[1,"flex","gap-4"],["type","button",1,"btn-secondary","flex-1",3,"click"],["type","submit",1,"btn-primary","flex-1",3,"disabled"],[1,"mb-4","relative"],[1,"relative","group"],["alt","Preview da imagem",1,"w-full","h-64","object-cover","rounded-lg","border-2","border-gray-300","shadow-md",3,"src"],[1,"absolute","inset-0","bg-black","bg-opacity-0","group-hover:bg-opacity-30","transition-opacity","rounded-lg","flex","items-center","justify-center"],["type","button",1,"opacity-0","group-hover:opacity-100","bg-red-600","text-white","px-4","py-2","rounded-lg","hover:bg-red-700","transition-opacity",3,"click"],["type","button",1,"mt-2","text-red-600","text-sm","hover:text-red-800","font-medium","inline-flex","items-center","gap-1",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"]],template:function(i,t){i&1&&(n(0,"div",2)(1,"div",3)(2,"h1",4),a(3,"Servi\xE7os"),r(),n(4,"button",5),d("click",function(){return t.abrirModal()}),a(5,"Novo Servi\xE7o"),r()(),n(6,"div",6)(7,"div",7)(8,"table",8)(9,"thead")(10,"tr",9)(11,"th",10),a(12,"Imagem"),r(),n(13,"th",10),a(14,"Nome"),r(),n(15,"th",10),a(16,"Dura\xE7\xE3o"),r(),n(17,"th",10),a(18,"Pre\xE7o"),r(),n(19,"th",10),a(20,"Status"),r(),n(21,"th",10),a(22,"A\xE7\xF5es"),r()()(),n(23,"tbody"),w(24,Y,19,10,"tr",11),r()()()(),w(25,ee,65,5,"div",12),r()),i&2&&(l(24),v("ngForOf",t.servicos),l(),v("ngIf",t.mostrarModal))},dependencies:[D,N,A,K,O,z,H,$,G,B,L,J],encapsulation:2})}}return u})();export{se as ServicosComponent};
